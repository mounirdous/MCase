<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>M Live Navigator — Challenges → Initiatives → Systems → KPIs</title>
<style>
  :root {
    --bg: #0b1220;
    --panel: #101a30;
    --panel2: #0f1730;
    --text: #e8eefc;
    --muted: #a9b5d6;
    --accent: #6aa6ff;
    --accent2: #3ddc97;
    --warn: #ffcc66;
    --danger: #ff6b6b;

    /* CISK color code (subtle, aligned with deck) */
    --c-challenge: #f0d24f;      /* yellow */
    --c-challenge-bg: rgba(240,210,79,.12);
    --c-initiative: #8fd0ff;     /* light blue */
    --c-initiative-bg: rgba(143,208,255,.12);
    --c-system: #1d4ed8;         /* dark blue */
    --c-system-bg: rgba(29,78,216,.10);
    --c-kpi: #22c55e;            /* green */
    --c-kpi-bg: rgba(34,197,94,.10);
    --border: rgba(255,255,255,0.08);
    --shadow: 0 10px 30px rgba(0,0,0,0.35);
    --radius: 14px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: var(--sans);
    background: radial-gradient(1200px 800px at 20% 0%, rgba(106,166,255,.18), transparent 50%),
                radial-gradient(900px 700px at 90% 10%, rgba(61,220,151,.12), transparent 60%),
                var(--bg);
    color: var(--text);
  }
  header {
    position: sticky; top: 0; z-index: 50;
    background: linear-gradient(180deg, rgba(11,18,32,.92), rgba(11,18,32,.75));
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
  }
  .wrap { max-width: 1400px; margin: 0 auto; padding: 14px 18px; }
  .topbar { display: flex; gap: 12px; align-items: center; justify-content: space-between; }
  .brand { display:flex; flex-direction: column; gap: 2px; }
  .brand .title { font-size: 16px; letter-spacing: .2px; font-weight: 700; }
  .brand .sub { font-size: 12px; color: var(--muted); }
  .tabs { display:flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
  .tabbtn {
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.04);
    color: var(--text);
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 12px;
    cursor: pointer;
    transition: .15s ease;
    user-select: none;
  }
  .tabbtn:hover { transform: translateY(-1px); border-color: rgba(106,166,255,.35); }
  .tabbtn.active { background: rgba(106,166,255,0.18); border-color: rgba(106,166,255,.5); }
  main .wrap { padding-top: 16px; padding-bottom: 28px; }

  .grid2 { display:grid; grid-template-columns: 380px 1fr; gap: 14px; }
  @media (max-width: 980px) { .grid2 { grid-template-columns: 1fr; } }

  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.03));
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .panel .hd { padding: 12px 12px 8px 12px; border-bottom: 1px solid var(--border); }
  .panel .hd .h1 { font-size: 13px; font-weight: 800; letter-spacing: .3px; }
  .panel .hd .h2 { font-size: 12px; color: var(--muted); margin-top: 4px; }
  .panel .bd { padding: 12px; }

  .search {
    display:flex; gap: 8px; align-items:center;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: rgba(0,0,0,0.18);
  }
  .search input {
    width: 100%;
    background: transparent;
    border: 0;
    color: var(--text);
    font-size: 13px;
    outline: none;
  }

  .chip {
    display:inline-flex; align-items:center; gap: 6px;
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 11px;
    color: var(--muted);
    background: rgba(255,255,255,0.03);
  }
  .chip.season { color: #dbe9ff; border-color: rgba(106,166,255,.35); background: rgba(106,166,255,.12); }
  
  .chip.group { 
    background: var(--c-challenge-bg);
    border: 1px solid rgba(255, 215, 64, 0.55);
    color: rgba(255, 232, 148, 0.95);
    font-weight: 800;
  }
  .tableWrap{
    max-height: 540px;
    overflow: auto;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: rgba(0,0,0,0.06);
  }
  .tableWrap table{ border-collapse: separate; border-spacing: 0; border: none; border-radius: 0; }
  .tree details{ border-left: 4px solid var(--c-challenge); }
.mono { font-family: var(--mono); }

  .list { display:flex; flex-direction: column; gap: 8px; margin-top: 12px; }
  .item {
    border: 1px solid var(--border);
    border-radius: 12px;
    background: rgba(0,0,0,0.12);
    padding: 10px;
    cursor: pointer;
    transition: .15s ease;
  }
  .item:hover { border-color: rgba(106,166,255,.35); transform: translateY(-1px); }
  .item.active { border-color: rgba(61,220,151,.5); background: rgba(61,220,151,.08); }
  .item .t { font-size: 13px; line-height: 1.25; font-weight: 650; }
  .item .m { font-size: 12px; color: var(--muted); margin-top: 5px; line-height: 1.35; }
  .row { display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }

  .btn {
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.03);
    color: var(--text);
    padding: 7px 9px;
    border-radius: 10px;
    font-size: 12px;
    cursor:pointer;
    transition: .15s ease;
  }
  .btn:hover { border-color: rgba(106,166,255,.35); transform: translateY(-1px); }
  .btn.primary { background: rgba(106,166,255,.18); border-color: rgba(106,166,255,.55); }
  .btn.ghost { background: transparent; }
  .btn.small { padding: 5px 7px; font-size: 11px; border-radius: 9px; }

  .detail h1 { margin: 0; font-size: 18px; letter-spacing: .2px; }
  .detail p { margin: 10px 0 0 0; color: var(--muted); font-size: 13px; line-height: 1.45; }

  .section { margin-top: 16px; }
  .section .st { font-size: 13px; font-weight: 800; margin: 0 0 8px 0; letter-spacing: .25px; }
  .pilllist { display:flex; flex-wrap: wrap; gap: 8px; }
  .linkpill {
    border: 1px solid var(--border);
    background: rgba(0,0,0,0.10);
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 12px;
    color: var(--text);
    cursor:pointer;
  }
  .linkpill:hover { border-color: rgba(106,166,255,.35); }

  /* Type-coded pills (subtle) */
  .linkpill.kind-challenge { border-color: rgba(240,210,79,.35); background: var(--c-challenge-bg); }
  .linkpill.kind-initiative { border-color: rgba(143,208,255,.35); background: var(--c-initiative-bg); }
  .linkpill.kind-system { border-color: rgba(29,78,216,.35); background: var(--c-system-bg); }
  .linkpill.kind-kpi { border-color: rgba(34,197,94,.35); background: var(--c-kpi-bg); }
  .linkpill.kind-challenge:hover { border-color: rgba(240,210,79,.6); }
  .linkpill.kind-initiative:hover { border-color: rgba(143,208,255,.6); }
  .linkpill.kind-system:hover { border-color: rgba(29,78,216,.6); }
  .linkpill.kind-kpi:hover { border-color: rgba(34,197,94,.6); }

  /* Type-coded list items */
  .item.kind-initiative { border-left: 4px solid rgba(143,208,255,.7); }
  .item.kind-system { border-left: 4px solid rgba(29,78,216,.75); }
  .item.kind-kpi { border-left: 4px solid rgba(34,197,94,.75); }
  .item.kind-initiative:hover { border-color: rgba(143,208,255,.35); }
  .item.kind-system:hover { border-color: rgba(29,78,216,.35); }
  .item.kind-kpi:hover { border-color: rgba(34,197,94,.35); }
  .item.kind-initiative.active { border-color: rgba(143,208,255,.65); background: rgba(143,208,255,.08); }
  .item.kind-system.active { border-color: rgba(29,78,216,.55); background: rgba(29,78,216,.06); }
  .item.kind-kpi.active { border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.06); }

  /* Type-coded workbench cards */
  .card.kind-challenge { border-left: 4px solid rgba(240,210,79,.8); }
  .card.kind-initiative { border-left: 4px solid rgba(143,208,255,.8); }
  .card.kind-system { border-left: 4px solid rgba(29,78,216,.85); }
  .card.kind-kpi { border-left: 4px solid rgba(34,197,94,.85); }

  .tree { font-size: 13px; }
  .tree details {
    border: 1px solid var(--border);
    background: rgba(0,0,0,0.10);
    border-radius: 12px;
    padding: 8px 10px;
  }
  .tree details + details { margin-top: 8px; }
  .tree summary {
    cursor: pointer;
    display:flex; align-items:center; justify-content: space-between;
    list-style: none;
  }
  .tree summary::-webkit-details-marker { display:none; }
  .tree .sub { margin-top: 8px; display:flex; flex-direction: column; gap: 6px; }
  .tree .sub .subitem {
    border-left: 3px solid var(--c-challenge);
    padding-left: 10px;
    color: var(--muted);
    cursor:pointer;
  }
  .tree .sub .subitem:hover { color: var(--text); }

  table { width: 100%; border-collapse: collapse; font-size: 12px; }
  th, td { padding: 8px 8px; border-bottom: 1px solid var(--border); vertical-align: top; }
  th {
    text-align: left;
    color: var(--muted);
    font-weight: 700;
    background: rgba(255,255,255,0.03);
    position: sticky;
    top: 62px;
    z-index: 5;
  }
  .num { text-align: right; font-family: var(--mono); }
  .nowrap { white-space: nowrap; }
  .footer { margin-top: 12px; color: var(--muted); font-size: 12px; }

  .kanban { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  @media (max-width: 1100px) { .kanban { grid-template-columns: 1fr; } }
  .col {
    border: 1px dashed rgba(255,255,255,0.18);
    border-radius: 14px;
    padding: 10px;
    background: rgba(0,0,0,0.10);
    min-height: 220px;
  }
  .col h3 { margin: 0 0 8px 0; font-size: 12px; letter-spacing: .4px; color: var(--muted); text-transform: uppercase; }
  .card { border: 1px solid var(--border); border-radius: 12px; padding: 10px; background: rgba(0,0,0,0.14); margin-bottom: 8px; }
  .card .t { font-size: 12.5px; font-weight: 700; }
  .card .m { font-size: 11.5px; color: var(--muted); margin-top: 4px; line-height: 1.35; }
  .card .actions { margin-top: 8px; display:flex; gap: 6px; flex-wrap: wrap; }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="title">M Live Navigator <span class="chip mono">C→I→S→K</span></div>
        <div class="sub">Navigate the case live: click any item to jump across.</div>
      </div>
      <div class="tabs" id="tabs"></div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div id="tab-challenges" class="tab">
      <div class="grid2">
        <div class="panel">
          <div class="hd">
            <div class="h1">Challenges tree</div>
            <div class="h2">Pick a challenge group, then a sub‑challenge.</div>
          </div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchChallenges" placeholder="Search challenges…" /></div>
            <div class="tree" id="challengeTree"></div>
            <div class="footer">Tip: click a sub‑challenge to see linked initiatives → systems → KPIs.</div>
          </div>
        </div>
        <div class="panel detail" id="challengeDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select something on the left.</div></div>
          <div class="bd" id="challengeDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-initiatives" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">Initiatives</div><div class="h2">Filter by season and challenge.</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchInitiatives" placeholder="Search initiatives…" /></div>
            <div class="row" style="margin-top:10px">
              <button class="btn small ghost" data-season="ALL" onclick="setInitSeason('ALL')">All</button>
              <button class="btn small" data-season="S1" onclick="setInitSeason('S1')">S1</button>
              <button class="btn small" data-season="S2" onclick="setInitSeason('S2')">S2</button>
              <button class="btn small" data-season="S3" onclick="setInitSeason('S3')">S3</button>
            </div>
            <div class="list" id="initiativeList"></div>
          </div>
        </div>
        <div class="panel detail" id="initiativeDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select an initiative.</div></div>
          <div class="bd" id="initiativeDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-systems" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">Systems / enablers</div><div class="h2">Shown per challenge (mapping is slide‑based).</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchSystems" placeholder="Search systems…" /></div>
            <div class="list" id="systemList"></div>
          </div>
        </div>
        <div class="panel detail" id="systemDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select a system.</div></div>
          <div class="bd" id="systemDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-kpis" class="tab" style="display:none">
      <div class="grid2">
        <div class="panel">
          <div class="hd"><div class="h1">KPIs</div><div class="h2">All KPIs referenced in the 6 challenge slides.</div></div>
          <div class="bd">
            <div class="search"><span class="chip mono">/</span><input id="searchKpis" placeholder="Search KPIs…" /></div>
            <div class="list" id="kpiList"></div>
          </div>
        </div>
        <div class="panel detail" id="kpiDetail">
          <div class="hd"><div class="h1">Details</div><div class="h2">Select a KPI.</div></div>
          <div class="bd" id="kpiDetailBody"></div>
        </div>
      </div>
    </div>

    <div id="tab-workbench" class="tab" style="display:none">
      <div class="panel">
        <div class="hd"><div class="h1">Workbench (pin / re-order)</div><div class="h2">Pin items and reorder them for your live Q&A flow.</div></div>
        <div class="bd">
          <div class="row">
            <button class="btn" onclick="clearWorkbench()">Clear</button>
            <button class="btn" onclick="saveWorkbench()">Save</button>
            <button class="btn" onclick="loadWorkbench()">Load</button>
            <span class="chip">On iPad: use ↑↓ if drag is awkward</span>
          </div>
          <div class="kanban" style="margin-top:12px" id="kanban"></div>
          <div class="footer">Pinned state is stored locally in your browser (safe to refresh).</div>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
const DATA = {"meta": {"generated": "2026-02-04T10:27:11", "sourceDeck": "WIP_B_v3.0.6_notes_cleaned.pptm"}, "challengeGroups": [{"id": "C1", "number": 1, "title": "Digital Transformation", "slide": 5}, {"id": "C2", "number": 2, "title": "Digital Architecture & Principles", "slide": 6}, {"id": "C3", "number": 3, "title": "ERP Consolidation Strategy", "slide": 7}, {"id": "C4", "number": 4, "title": "Operating Model & Governance", "slide": 8}, {"id": "C5", "number": 5, "title": "Security & Compliance", "slide": 9}, {"id": "C6", "number": 6, "title": "Risk & Mitigation", "slide": 10}], "subChallenges": [{"id": "C1.SC1", "groupId": "C1", "text": "Lead-time too long/variable across Order→Engineering→Supply→Build"}, {"id": "C1.SC2", "groupId": "C1", "text": "On-time delivery gaps; late surprises drive expediting & firefighting"}, {"id": "C1.SC3", "groupId": "C1", "text": "Inventory/WIP buffers due to limited visibility & planning discipline"}, {"id": "C1.SC4", "groupId": "C1", "text": "Cost transparency gaps (standard cost, variances, margin leakage)"}, {"id": "C1.SC5", "groupId": "C1", "text": "Digital services not yet packaged/scaled (remote support, predictive)"}, {"id": "C1.SC6", "groupId": "C1", "text": "Customer experience fragmented (3 CRMs); limited pipeline & service visibility; inconsistent customer master"}, {"id": "C2.SC1", "groupId": "C2", "text": "Fragmented landscape (multiple ERP/CRM instances; local solutions)"}, {"id": "C2.SC2", "groupId": "C2", "text": "Point‑to‑point integrations create fragility and high change cost"}, {"id": "C2.SC3", "groupId": "C2", "text": "No single trusted data layer for plant-to-board decisions"}, {"id": "C2.SC4", "groupId": "C2", "text": "OT/IT + IIoT constraints: segmented shop‑floor, sensor connectivity, uptime, safety, vendor access"}, {"id": "C2.SC5", "groupId": "C2", "text": "Cloud + connectivity heterogeneity (incl. Wi‑Fi/5G); resilience & DR not uniform"}, {"id": "C2.SC6", "groupId": "C2", "text": "Digital services scale needs secure connectivity + reusable patterns"}, {"id": "C3.SC1", "groupId": "C3", "text": "Multiple ERP cores (3 SAP instances) + local CN system + process variants → duplication & friction"}, {"id": "C3.SC2", "groupId": "C3", "text": "Master data inconsistent (materials, BOMs, routings, supplier/customer) across divisions"}, {"id": "C3.SC3", "groupId": "C3", "text": "Excel workarounds for planning, costing, reporting → slow decisions and errors"}, {"id": "C3.SC4", "groupId": "C3", "text": "Limited end‑to‑end traceability across PLM ↔ shop‑floor ↔ quality ↔ service"}, {"id": "C3.SC5", "groupId": "C3", "text": "Cost transparency gaps (cost-to-serve, inventory accuracy, margin leakage)"}, {"id": "C3.SC6", "groupId": "C3", "text": "SAP program already in motion (partner likely selected) → need a health-check, not a restart"}, {"id": "C4.SC1", "groupId": "C4", "text": "IT perceived as reactive; unclear ownership → slow delivery and ‘firefighting’"}, {"id": "C4.SC2", "groupId": "C4", "text": "Decentralised divisions; low trust in group standards → resistance to harmonisation"}, {"id": "C4.SC3", "groupId": "C4", "text": "Portfolio noise: no single intake/waterline → too many priorities at once"}, {"id": "C4.SC4", "groupId": "C4", "text": "Change capacity constraints; training/adoption often under-funded"}, {"id": "C4.SC5", "groupId": "C4", "text": "High cost-to-serve + licence/tool sprawl; sourcing/nearshoring not fully optimised"}, {"id": "C4.SC6", "groupId": "C4", "text": "Business/IT misalignment: requirements and outcomes not co‑owned end‑to‑end"}, {"id": "C5.SC1", "groupId": "C5", "text": "Expanded attack surface (cloud, remote access, supplier connections, IoT)"}, {"id": "C5.SC2", "groupId": "C5", "text": "OT constraints + legacy devices → segmentation and patching are hard"}, {"id": "C5.SC3", "groupId": "C5", "text": "Identity & privileged access sprawl; inconsistent access governance"}, {"id": "C5.SC4", "groupId": "C5", "text": "Limited detection/response maturity (logging, SOC, incident routines)"}, {"id": "C5.SC5", "groupId": "C5", "text": "Audit/compliance pressure (customers, GDPR/ISO, evidence needed at any time)"}, {"id": "C5.SC6", "groupId": "C5", "text": "Third‑party risk (partners, integrators) + SAP programme security gates"}, {"id": "C6.SC1", "groupId": "C6", "text": "If divisions resist standardisation, benefits won’t land (Excel/workarounds persist)"}, {"id": "C6.SC2", "groupId": "C6", "text": "If data quality is weak, planning and inventory KPIs won’t move"}, {"id": "C6.SC3", "groupId": "C6", "text": "If we disrupt plants during cutovers, trust is lost and programme stalls"}, {"id": "C6.SC4", "groupId": "C6", "text": "If scope/customisation grows, costs and timelines explode (clean core violated)"}, {"id": "C6.SC5", "groupId": "C6", "text": "If vendors/partners under‑deliver, knowledge and control erode"}, {"id": "C6.SC6", "groupId": "C6", "text": "If security/OT constraints are ignored, risk increases during transformation"}], "initiatives": [{"id": "C1.I1", "groupId": "C1", "season": "S1", "text": "Value streams & standard E2E processes (P2P, ETO, Service) + CRM blueprint (3→1)", "raw": "S1: Value streams & standard E2E processes (P2P, ETO, Service) + CRM blueprint (3→1)"}, {"id": "C1.I2", "groupId": "C1", "season": "S1", "text": "Planning discipline & control‑tower routines (S&OP/MRP, exception mgmt)", "raw": "S1: Planning discipline & control‑tower routines (S&OP/MRP, exception mgmt)"}, {"id": "C1.I3", "groupId": "C1", "season": "S2", "text": "Shop‑floor visibility on critical lines (WIP, bottlenecks, digital WI)", "raw": "S2: Shop‑floor visibility on critical lines (WIP, bottlenecks, digital WI)"}, {"id": "C1.I4", "groupId": "C1", "season": "S2", "text": "Closed‑loop quality & traceability (NC/CAPA, root‑cause analytics)", "raw": "S2: Closed‑loop quality & traceability (NC/CAPA, root‑cause analytics)"}, {"id": "C1.I5", "groupId": "C1", "season": "S2", "text": "Productise digital services (offers, pricing, portal; adoption KPIs)", "raw": "S2: Productise digital services (offers, pricing, portal; adoption KPIs)"}, {"id": "C1.I6", "groupId": "C1", "season": "S3", "text": "Board targets achieved: CRM consolidated, services scaled, ROAI analytics/AI", "raw": "S3: Board targets achieved: CRM consolidated, services scaled, ROAI analytics/AI"}, {"id": "C2.I1", "groupId": "C2", "season": "S1", "text": "Confirm target architecture + principles (clean core, digital thread, secure-by-design)", "raw": "S1: Confirm target architecture + principles (clean core, digital thread, secure-by-design)"}, {"id": "C2.I2", "groupId": "C2", "season": "S1", "text": "Integration standards + platform selection (API/events, iPaaS)", "raw": "S1: Integration standards + platform selection (API/events, iPaaS)"}, {"id": "C2.I3", "groupId": "C2", "season": "S1", "text": "Data governance + KPI semantic layer v1 (plant‑to‑board)", "raw": "S1: Data governance + KPI semantic layer v1 (plant‑to‑board)"}, {"id": "C2.I4", "groupId": "C2", "season": "S2", "text": "Implement iPaaS/API; retire top point‑to‑point interfaces", "raw": "S2: Implement iPaaS/API; retire top point‑to‑point interfaces"}, {"id": "C2.I5", "groupId": "C2", "season": "S2", "text": "Enterprise data platform + historian/time‑series (ERP/CRM/MES/PLM priority domains)", "raw": "S2: Enterprise data platform + historian/time‑series (ERP/CRM/MES/PLM priority domains)"}, {"id": "C2.I6", "groupId": "C2", "season": "S2", "text": "Standard infra + OT connectivity baseline (hybrid cloud, LAN/Wi‑Fi/5G, shop‑floor zones, DR)", "raw": "S2: Standard infra + OT connectivity baseline (hybrid cloud, LAN/Wi‑Fi/5G, shop‑floor zones, DR)"}, {"id": "C2.I7", "groupId": "C2", "season": "S3", "text": "End‑to‑end digital thread + cross‑site KPI model (PLM↔ERP↔MES↔service)", "raw": "S3: End‑to‑end digital thread + cross‑site KPI model (PLM↔ERP↔MES↔service)"}, {"id": "C3.I1", "groupId": "C3", "season": "S1", "text": "One S/4HANA template; clean core; explicit exceptions (incl. CN path)", "raw": "S1: One S/4HANA template; clean core; explicit exceptions (incl. CN path)"}, {"id": "C3.I2", "groupId": "C3", "season": "S1", "text": "Master data ownership + quality rules (harmonised)", "raw": "S1: Master data ownership + quality rules (harmonised)"}, {"id": "C3.I3", "groupId": "C3", "season": "S1", "text": "Standard core processes (O2C, P2P, Plan‑to‑Produce, ETO)", "raw": "S1: Standard core processes (O2C, P2P, Plan‑to‑Produce, ETO)"}, {"id": "C3.I4", "groupId": "C3", "season": "S2", "text": "S/4 pilot live + Finance value gate; first rollout waves launched", "raw": "S2: S/4 pilot live + Finance value gate; first rollout waves launched"}, {"id": "C3.I5", "groupId": "C3", "season": "S1", "text": "Plant‑to‑board KPI layer (cost, inventory, delivery, quality)", "raw": "S1: Plant‑to‑board KPI layer (cost, inventory, delivery, quality)"}, {"id": "C3.I6", "groupId": "C3", "season": "S3", "text": "Complete waves + retire legacy; standard processes embedded", "raw": "S3: Complete waves + retire legacy; standard processes embedded"}, {"id": "C4.I1", "groupId": "C4", "season": "S1", "text": "Co‑owned Business/IT operating model (service + product/value partner)", "raw": "S1: Co‑owned Business/IT operating model (service + product/value partner)"}, {"id": "C4.I2", "groupId": "C4", "season": "S1", "text": "Decision rights + portfolio waterline (priorities/funding/outcome owner; stop/pivot)", "raw": "S1: Decision rights + portfolio waterline (priorities/funding/outcome owner; stop/pivot)"}, {"id": "C4.I3", "groupId": "C4", "season": "S1", "text": "Finance‑auditable value governance (benefits tracker + quarterly value gates)", "raw": "S1: Finance‑auditable value governance (benefits tracker + quarterly value gates)"}, {"id": "C4.I4", "groupId": "C4", "season": "S1", "text": "Culture shift + adoption model (service → product/value; measurable uptake)", "raw": "S1: Culture shift + adoption model (service → product/value; measurable uptake)"}, {"id": "C4.I5", "groupId": "C4", "season": "S2", "text": "Right sourcing (outsource commodity ops; retain Competency Center)", "raw": "S2: Right sourcing (outsource commodity ops; retain Competency Center)"}, {"id": "C4.I6", "groupId": "C4", "season": "S3", "text": "Continuous improvement cadence (process mining / automation where justified)", "raw": "S3: Continuous improvement cadence (process mining / automation where justified)"}, {"id": "C5.I1", "groupId": "C5", "season": "S1", "text": "Risk‑based security roadmap (crown jewels, threats, prioritised controls)", "raw": "S1: Risk‑based security roadmap (crown jewels, threats, prioritised controls)"}, {"id": "C5.I2", "groupId": "C5", "season": "S1", "text": "Identity baseline incl. MFA + least privilege + JML + PAM", "raw": "S1: Identity baseline incl. MFA + least privilege + JML + PAM"}, {"id": "C5.I3", "groupId": "C5", "season": "S1", "text": "OT security baseline (segmentation, secure remote access, vuln routine)", "raw": "S1: OT security baseline (segmentation, secure remote access, vuln routine)"}, {"id": "C5.I4", "groupId": "C5", "season": "S2", "text": "Detection & response (central logging → SIEM/SOC; playbooks)", "raw": "S2: Detection & response (central logging → SIEM/SOC; playbooks)"}, {"id": "C5.I5", "groupId": "C5", "season": "S3", "text": "Resilience & audit readiness embedded (DR tests; OT patch/vuln cadence)", "raw": "S3: Resilience & audit readiness embedded (DR tests; OT patch/vuln cadence)"}, {"id": "C5.I6", "groupId": "C5", "season": "S1", "text": "Security culture + vendor risk + audit drills", "raw": "S1: Security culture + vendor risk + audit drills"}, {"id": "C6.I1", "groupId": "C6", "season": "S1", "text": "Standard vs local boundaries + exception governance", "raw": "S1: Standard vs local boundaries + exception governance"}, {"id": "C6.I2", "groupId": "C6", "season": "S1", "text": "Wave readiness gates + cutover/rollback playbook (plant-safe)", "raw": "S1: Wave readiness gates + cutover/rollback playbook (plant-safe)"}, {"id": "C6.I3", "groupId": "C6", "season": "S1", "text": "Benefits tracker + no‑double‑count rules; value gates (blueprint→pilot→scale)", "raw": "S1: Benefits tracker + no‑double‑count rules; value gates (blueprint→pilot→scale)"}, {"id": "C6.I4", "groupId": "C6", "season": "S2", "text": "Change system (super-users, training, incentives; adoption KPIs; Excel kill‑plan)", "raw": "S2: Change system (super-users, training, incentives; adoption KPIs; Excel kill‑plan)"}, {"id": "C6.I5", "groupId": "C6", "season": "S2", "text": "Vendor governance (SLAs, demos, health‑check, exit plan)", "raw": "S2: Vendor governance (SLAs, demos, health‑check, exit plan)"}, {"id": "C6.I6", "groupId": "C6", "season": "S3", "text": "Sustain value/risk control: tech‑debt retirement; benefits realised vs plan", "raw": "S3: Sustain value/risk control: tech‑debt retirement; benefits realised vs plan"}], "systems": [{"id": "C1.S1", "groupId": "C1", "text": "Core ERP (SAP S/4HANA as system of record)"}, {"id": "C1.S2", "groupId": "C1", "text": "Planning cockpit (MRP exceptions / APS where needed)"}, {"id": "C1.S3", "groupId": "C1", "text": "MES / Quality execution (critical lines; traceability)"}, {"id": "C1.S4", "groupId": "C1", "text": "PLM + Engineering change control (ECR/ECO) integrated"}, {"id": "C1.S5", "groupId": "C1", "text": "Enterprise data platform + KPI layer (BI, analytics, AI-ready)"}, {"id": "C1.S6", "groupId": "C1", "text": "CRM core (Salesforce 3→1) + customer portal + secure remote connectivity / IoT data capture"}, {"id": "C3.S1", "groupId": "C3", "text": "SAP S/4HANA as digital core + ‘clean core’ guardrails (standard first)"}, {"id": "C3.S2", "groupId": "C3", "text": "Master data governance & tooling (workflows, validation, ownership/RACI)"}, {"id": "C3.S3", "groupId": "C3", "text": "Integration platform (iPaaS/API/events) + retire point‑to‑point interfaces"}, {"id": "C3.S4", "groupId": "C3", "text": "MES/QMS integration on critical lines to unlock traceability & COPQ reduction"}, {"id": "C3.S5", "groupId": "C3", "text": "Delivery factory: testing, cutover runbooks, rehearsals, training & hypercare"}, {"id": "C3.S6", "groupId": "C3", "text": "Partner model + retained Competency Center (architecture, data, security, vendor governance)"}, {"id": "C4.S1", "groupId": "C4", "text": "Executive governance: ExCo steering + quarterly value gates + decision log"}, {"id": "C4.S2", "groupId": "C4", "text": "Digital investment framework: categories, scoring, waterline, benefits tracking"}, {"id": "C4.S3", "groupId": "C4", "text": "Product & process ownership (ERP / Data / Security / Service) + RACI"}, {"id": "C4.S4", "groupId": "C4", "text": "Service operations system: ITSM + service catalogue + SLA dashboards; ‘runner/repeater/stranger’ support tiers"}, {"id": "C4.S5", "groupId": "C4", "text": "Vendor & partner governance: managed services towers, SLAs, KPI dashboards, escalation paths"}, {"id": "C4.S6", "groupId": "C4", "text": "People & change system: change champions, training academy, incentives, role upgrades (PO, data owners)"}, {"id": "C5.S1", "groupId": "C5", "text": "MFA / Identity platform (SSO, conditional access)"}, {"id": "C5.S2", "groupId": "C5", "text": "PAM (privileged vault, session recording)"}, {"id": "C5.S3", "groupId": "C5", "text": "Endpoint protection (EDR) + device hygiene / patch tooling"}, {"id": "C5.S4", "groupId": "C5", "text": "Central logging + SIEM/SOAR + SOC (managed where useful)"}, {"id": "C5.S5", "groupId": "C5", "text": "Network segmentation (IT/OT zones), firewalls, secure remote access"}, {"id": "C5.S6", "groupId": "C5", "text": "Resilience: backup/DR, immutable backups, recovery testing"}, {"id": "C6.S1", "groupId": "C6", "text": "Programme control tower: PMO + risk register + decision log"}, {"id": "C6.S2", "groupId": "C6", "text": "Wave readiness scorecard + go/no‑go forum"}, {"id": "C6.S3", "groupId": "C6", "text": "Cutover runbooks, rehearsal environment, rollback criteria, hypercare model"}, {"id": "C6.S4", "groupId": "C6", "text": "Benefits tracker (cash/EBIT/revenue/run-cost) + evidence pack"}, {"id": "C6.S5", "groupId": "C6", "text": "Data governance system (owners, quality rules, stewardship tooling)"}, {"id": "C6.S6", "groupId": "C6", "text": "Partner performance dashboard + escalation paths (internal Competency Center)"}], "kpis": [{"id": "C1.K1", "groupId": "C1", "text": "Lead time −15–20% (end‑to‑end, incl. engineering + supply)"}, {"id": "C1.K2", "groupId": "C1", "text": "On-time delivery +5–8 percentage points (definition agreed)"}, {"id": "C1.K3", "groupId": "C1", "text": "Inventory turns +10–15% + WIP aging reduced"}, {"id": "C1.K4", "groupId": "C1", "text": "Cost of poor quality (COPQ) −10% (scrap + rework + warranty)"}, {"id": "C1.K5", "groupId": "C1", "text": "Digital services revenue enabled +CHF 3–8m/year by Year 3"}, {"id": "C1.K6", "groupId": "C1", "text": "Net value KPI: benefits vs (investment + run‑cost Δ), Finance-signed quarterly"}, {"id": "C2.K1", "groupId": "C2", "text": "Core simplification: ERP instances (3→1); CRM instances (3→1)"}, {"id": "C2.K2", "groupId": "C2", "text": "Integration health: % interfaces via iPaaS/API (incl. OT); # point‑to‑point retired"}, {"id": "C2.K3", "groupId": "C2", "text": "Data quality: master data accuracy/completeness; “single version of truth” adoption"}, {"id": "C2.K4", "groupId": "C2", "text": "Platform resilience: availability; RTO/RPO achieved for critical IT+OT services"}, {"id": "C2.K5", "groupId": "C2", "text": "Security coverage: MFA/PAM/logging coverage; OT segmentation & secure remote access compliance"}, {"id": "C2.K6", "groupId": "C2", "text": "Delivery speed: time to onboard a new site/line/machine; change failure rate"}, {"id": "C3.K1", "groupId": "C3", "text": "Consolidation: ERP cores → 1; legacy systems retired per wave plan"}, {"id": "C3.K2", "groupId": "C3", "text": "Finance efficiency: close cycle time ↓; manual reconciliations ↓; auditability ↑"}, {"id": "C3.K3", "groupId": "C3", "text": "Operational control: inventory accuracy ↑; inventory turns +10–15%; WIP aging ↓"}, {"id": "C3.K4", "groupId": "C3", "text": "Cost transparency: standard cost coverage ↑; variance drill-down cycle ↓"}, {"id": "C3.K5", "groupId": "C3", "text": "Service to the business: fewer workarounds; process compliance/adoption ↑"}, {"id": "C3.K6", "groupId": "C3", "text": "Cost control: programme burn rate vs budget; run-cost per user/ticket ↓"}, {"id": "C4.K1", "groupId": "C4", "text": "Stakeholder trust: IT NPS / satisfaction ↑; fewer escalations"}, {"id": "C4.K2", "groupId": "C4", "text": "Delivery performance: % initiatives delivered on time/on value; cycle time idea→release ↓"}, {"id": "C4.K3", "groupId": "C4", "text": "Adoption: active usage, process compliance, training completion; Excel workarounds ↓"}, {"id": "C4.K4", "groupId": "C4", "text": "Run-cost optimisation: licences rationalised; cost per ticket ↓; run-cost Δ tracked"}, {"id": "C4.K5", "groupId": "C4", "text": "Governance effectiveness: decision cycle time ↓; fewer uncontrolled exceptions"}, {"id": "C4.K6", "groupId": "C4", "text": "Talent & culture: engagement ↑; critical roles filled; attrition ↓; capability coverage ↑"}, {"id": "C5.K1", "groupId": "C5", "text": "MFA coverage (%) + % privileged accounts under PAM"}, {"id": "C5.K2", "groupId": "C5", "text": "Vulnerability aging: % critical patched within SLA; OT compensating controls"}, {"id": "C5.K3", "groupId": "C5", "text": "MTTD and MTTR for security incidents (target ↓)"}, {"id": "C5.K4", "groupId": "C5", "text": "Phishing resilience: click rate ↓; training completion ↑"}, {"id": "C5.K5", "groupId": "C5", "text": "Audit readiness: # major findings = 0; time to produce evidence ↓"}, {"id": "C5.K6", "groupId": "C5", "text": "Resilience: backup restore success rate; RTO/RPO met in tests"}, {"id": "C6.K1", "groupId": "C6", "text": "Wave readiness score (% green) before go‑live; # waves delayed for readiness (ok)"}, {"id": "C6.K2", "groupId": "C6", "text": "Adoption: training completion; active users; process compliance rate"}, {"id": "C6.K3", "groupId": "C6", "text": "Data quality score (master + transactional); inventory accuracy"}, {"id": "C6.K4", "groupId": "C6", "text": "Delivery health: schedule variance, milestone hit rate, change failure rate"}, {"id": "C6.K5", "groupId": "C6", "text": "Cost control: burn rate vs budget; run‑cost delta tracked"}, {"id": "C6.K6", "groupId": "C6", "text": "Operational stability: incident rate during/after releases; downtime minutes"}]};

const TABS = [
{id:"challenges", label:"Challenges"},
  {id:"initiatives", label:"Initiatives"},
  {id:"systems", label:"Systems"},
  {id:"kpis", label:"KPIs"},
  {id:"workbench", label:"Workbench"},
];

let state = {
  tab: "challenges",
  selected: null, // {type, id}
  initSeason: "ALL",
  workbench: { Challenges: [], Initiatives: [], Systems: [], KPIs: [] }
};

function byId(id) { return document.getElementById(id); }
function esc(s) {
  return (s ?? "").toString().replace(/[&<>"']/g, (m) => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m]));
}

function setTab(tabId) {
  state.tab = tabId;
  for (const t of TABS) {
    const el = byId("tab-"+t.id);
    el.style.display = (t.id === tabId) ? "" : "none";
  }
  for (const btn of document.querySelectorAll(".tabbtn")) {
    btn.classList.toggle("active", btn.dataset.tab === tabId);
  }
  const sel = state.selected ? `${state.selected.type}:${state.selected.id}` : "";
  history.replaceState(null, "", "#" + tabId + (sel ? ("/"+sel) : ""));
}

function renderTabs() {
  const host = byId("tabs");
  host.innerHTML = "";
  for (const t of TABS) {
    const b = document.createElement("button");
    b.className = "tabbtn" + (t.id===state.tab ? " active" : "");
    b.textContent = t.label;
    b.dataset.tab = t.id;
    b.onclick = () => setTab(t.id);
    host.appendChild(b);
  }
}

function groupTitle(groupId) {
  const g = DATA.challengeGroups.find(x=>x.id===groupId);
  return g ? `Challenge ${g.number}: ${g.title}` : groupId;
}

function findInitiativesForGroup(groupId) { return DATA.initiatives.filter(i=>i.groupId===groupId); }
function findSystemsForGroup(groupId) { return DATA.systems.filter(s=>s.groupId===groupId); }
function findKpisForGroup(groupId) { return DATA.kpis.filter(k=>k.groupId===groupId); }
function findSubChallengesForGroup(groupId) { return DATA.subChallenges.filter(sc=>sc.groupId===groupId); }

function inferTab(type) {
  if (type==="challengeGroup" || type==="subChallenge") return "challenges";
  if (type==="initiative") return "initiatives";
  if (type==="system") return "systems";
  if (type==="kpi") return "kpis";
  return "challenges";
}

function select(type, id, {autoTab=null}={}) {
  state.selected = {type, id};
  if (autoTab) setTab(autoTab);

  if (type==="challengeGroup" || type==="subChallenge") renderChallengeDetail(type,id);
  if (type==="initiative") renderInitiativeDetail(id);
  if (type==="system") renderSystemDetail(id);
  if (type==="kpi") renderKpiDetail(id);

  document.querySelectorAll(".item").forEach(el => el.classList.remove("active"));
  const el = document.querySelector(`[data-key="${type}:${id}"]`);
  if (el) el.classList.add("active");
}

function linkPills(items, onClick, kind=null) {
  if (!items.length) return `<span class="muted">None</span>`;
  const k = kind ? ` kind-${kind}` : ``;
  return `<div class="pilllist">` + items.map(it => `
    <span class="linkpill${k}" onclick="${onClick}('${it.id}')">${esc(it.label)}</span>
  `).join("") + `</div>`;
}

function jumpInit(id) { select("initiative", id, {autoTab:"initiatives"}); }
function jumpSys(id) { select("system", id, {autoTab:"systems"}); }
function jumpKpi(id) { select("kpi", id, {autoTab:"kpis"}); }
function jumpSub(id) { select("subChallenge", id, {autoTab:"challenges"}); }

function renderChallengeTree() {
  const host = byId("challengeTree");
  host.innerHTML = "";
  const q = (byId("searchChallenges").value || "").toLowerCase().trim();

  for (const g of DATA.challengeGroups.slice().sort((a,b)=>a.number-b.number)) {
    const subs = findSubChallengesForGroup(g.id);
    const matchesGroup = (`${g.title}`.toLowerCase().includes(q));
    const matchesSubs = subs.filter(sc => sc.text.toLowerCase().includes(q));
    if (q && !matchesGroup && matchesSubs.length===0) continue;

    const d = document.createElement("details");
    d.open = false; // start collapsed
    // If user is searching, auto-open groups that have a match
    if(q && (g.title.toLowerCase().includes(q) || subs.some(s=> (s.text||'').toLowerCase().includes(q)))) d.open = true;
const s = document.createElement("summary");
    s.innerHTML = `<span><span class="chip group mono">${g.id}</span> ${esc(g.title)}</span><span class="chip mono">${subs.length} sub</span>`;
    d.appendChild(s);

    const subDiv = document.createElement("div");
    subDiv.className = "sub";
    const showSubs = (q ? matchesSubs : subs);
    for (const sc of showSubs) {
      const div = document.createElement("div");
      div.className = "subitem kind-challenge";
      div.setAttribute("data-key", `subChallenge:${sc.id}`);
      div.innerHTML = `${esc(sc.text)}`;
      div.onclick = () => select("subChallenge", sc.id, {autoTab:"challenges"});
      subDiv.appendChild(div);
    }
    d.appendChild(subDiv);

    s.addEventListener("dblclick", (ev)=>{ ev.preventDefault(); select("challengeGroup", g.id, {autoTab:"challenges"}); });
    host.appendChild(d);
  }
}

function renderChallengeDetail(type, id) {
  const host = byId("challengeDetailBody");

  if (type==="challengeGroup") {
    const g = DATA.challengeGroups.find(x=>x.id===id);
    if (!g) return;

    const subs = findSubChallengesForGroup(id).map(sc => ({id: sc.id, label: sc.text}));
    const inits = findInitiativesForGroup(id).map(i => ({id: i.id, label: (i.season? i.season+": " : "") + i.text}));
    const sys = findSystemsForGroup(id).map(s => ({id: s.id, label: s.text}));
    const k = findKpisForGroup(id).map(k => ({id:k.id, label:k.text}));

    host.innerHTML = `
      <h1>${esc(groupTitle(id))}</h1>
      <p>Click any pill to jump tabs and continue the chain.</p>

      <div class="section"><div class="st">Sub‑challenges</div>${linkPills(subs, "jumpSub", "challenge")}</div>
      <div class="section"><div class="st">Initiatives (linked)</div>${linkPills(inits, "jumpInit", "initiative")}</div>
      <div class="section"><div class="st">Systems / enablers (shown)</div>${linkPills(sys, "jumpSys", "system")}</div>
      <div class="section"><div class="st">KPIs (measured)</div>${linkPills(k, "jumpKpi", "kpi")}</div>

      <div class="section">
        <div class="st">Quick actions</div>
        <div class="row">
          <button class="btn primary" onclick="pinToWorkbench('Challenges', 'challengeGroup', '${id}')">Pin</button>
          <button class="btn" onclick="setTab('initiatives')">Go to initiatives</button>
        </div>
      </div>
    `;
    return;
  }

  if (type==="subChallenge") {
    const sc = DATA.subChallenges.find(x=>x.id===id);
    if (!sc) return;

    const gId = sc.groupId;
    const g = DATA.challengeGroups.find(x=>x.id===gId);
    const inits = findInitiativesForGroup(gId).map(i => ({id: i.id, label: (i.season? i.season+": " : "") + i.text}));
    const sys = findSystemsForGroup(gId).map(s => ({id: s.id, label: s.text}));
    const k = findKpisForGroup(gId).map(k => ({id:k.id, label:k.text}));

    host.innerHTML = `
      <h1>${esc(sc.text)}</h1>
      <p><span class="chip season mono">${gId}</span> ${esc(g?.title || "")}</p>

      <div class="section"><div class="st">Initiatives (slide‑based mapping)</div>${linkPills(inits, "jumpInit", "initiative")}</div>
      <div class="section"><div class="st">Systems involved</div>${linkPills(sys, "jumpSys", "system")}</div>
      <div class="section"><div class="st">KPIs we move / monitor</div>${linkPills(k, "jumpKpi", "kpi")}</div>

      <div class="section">
        <div class="st">Quick actions</div>
        <div class="row">
          <button class="btn primary" onclick="pinToWorkbench('Challenges', 'subChallenge', '${id}')">Pin</button>
          <button class="btn" onclick="select('challengeGroup','${gId}',{autoTab:'challenges'})">Open challenge group</button>
        </div>
      </div>
    `;
  }
}

function setInitSeason(season) {
  state.initSeason = season;
  document.querySelectorAll('[data-season]').forEach(b=>{
    b.classList.toggle('primary', b.dataset.season===season);
  });
  renderInitiativeList();
}

function renderInitiativeList() {
  const host = byId("initiativeList");
  const q = (byId("searchInitiatives").value || "").toLowerCase().trim();
  host.innerHTML = "";

  let items = DATA.initiatives.slice();
  if (state.initSeason !== "ALL") items = items.filter(i=>i.season===state.initSeason);
  if (q) items = items.filter(i => (i.raw || i.text).toLowerCase().includes(q) || groupTitle(i.groupId).toLowerCase().includes(q));

  items.sort((a,b) => {
    const sa = a.season || "S9", sb = b.season || "S9";
    if (sa !== sb) return sa.localeCompare(sb);
    return a.groupId.localeCompare(b.groupId);
  });

  for (const i of items) {
    const div = document.createElement("div");
    div.className = "item kind-initiative";
    div.setAttribute("data-key", `initiative:${i.id}`);
    div.onclick = () => select("initiative", i.id, {autoTab:"initiatives"});
    div.innerHTML = `
      <div class="row" style="justify-content: space-between;">
        <div class="t">${esc(i.text)}</div>
        <div class="row">
          ${i.season ? `<span class="chip season mono">${i.season}</span>` : ""}
          <span class="chip group mono">${i.groupId}</span>
        </div>
      </div>
      <div class="m">${esc(groupTitle(i.groupId))}</div>
    `;
    host.appendChild(div);
  }
}

function renderInitiativeDetail(id) {
  const host = byId("initiativeDetailBody");
  const i = DATA.initiatives.find(x=>x.id===id);
  if (!i) return;

  const gId = i.groupId;
  const subs = findSubChallengesForGroup(gId).map(sc => ({id: sc.id, label: sc.text}));
  const sys = findSystemsForGroup(gId).map(s => ({id: s.id, label: s.text}));
  const k = findKpisForGroup(gId).map(k => ({id:k.id, label:k.text}));

  host.innerHTML = `
    <h1>${esc(i.text)}</h1>
    <p><span class="chip season mono">${esc(i.season || "—")}</span> <span class="chip group mono">${gId}</span> ${esc(groupTitle(gId))}</p>
    <div class="section"><div class="st">Addresses</div>${linkPills(subs, "jumpSub", "challenge")}</div>
    <div class="section"><div class="st">Systems</div>${linkPills(sys, "jumpSys", "system")}</div>
    <div class="section"><div class="st">Measured by</div>${linkPills(k, "jumpKpi", "kpi")}</div>
    <div class="section">
      <div class="st">Quick actions</div>
      <div class="row">
        <button class="btn primary" onclick="pinToWorkbench('Initiatives','initiative','${id}')">Pin</button>
        <button class="btn" onclick="select('challengeGroup','${gId}',{autoTab:'challenges'})">Back to challenge</button>
      </div>
    </div>
  `;
}

function renderSystemList() {
  const host = byId("systemList");
  const q = (byId("searchSystems").value || "").toLowerCase().trim();
  host.innerHTML = "";

  let items = DATA.systems.slice();
  if (q) items = items.filter(s => s.text.toLowerCase().includes(q) || groupTitle(s.groupId).toLowerCase().includes(q));
  items.sort((a,b)=>a.groupId.localeCompare(b.groupId));

  for (const s of items) {
    const div = document.createElement("div");
    div.className = "item kind-system";
    div.setAttribute("data-key", `system:${s.id}`);
    div.onclick = () => select("system", s.id, {autoTab:"systems"});
    div.innerHTML = `
      <div class="row" style="justify-content: space-between;">
        <div class="t">${esc(s.text)}</div>
        <div class="row"><span class="chip group mono">${s.groupId}</span></div>
      </div>
      <div class="m">${esc(groupTitle(s.groupId))}</div>
    `;
    host.appendChild(div);
  }
}

function renderSystemDetail(id) {
  const host = byId("systemDetailBody");
  const s = DATA.systems.find(x=>x.id===id);
  if (!s) return;

  const gId = s.groupId;
  const inits = findInitiativesForGroup(gId).map(i => ({id: i.id, label: (i.season? i.season+": " : "") + i.text}));
  const k = findKpisForGroup(gId).map(k => ({id:k.id, label:k.text}));

  host.innerHTML = `
    <h1>${esc(s.text)}</h1>
    <p><span class="chip group mono">${gId}</span> ${esc(groupTitle(gId))}</p>
    <div class="section"><div class="st">Used by initiatives</div>${linkPills(inits, "jumpInit", "initiative")}</div>
    <div class="section"><div class="st">Linked KPIs</div>${linkPills(k, "jumpKpi", "kpi")}</div>
    <div class="section">
      <div class="st">Quick actions</div>
      <div class="row">
        <button class="btn primary" onclick="pinToWorkbench('Systems','system','${id}')">Pin</button>
        <button class="btn" onclick="setTab('kpis')">Go to KPIs</button>
      </div>
    </div>
  `;
}

function renderKpiList() {
  const host = byId("kpiList");
  const q = (byId("searchKpis").value || "").toLowerCase().trim();
  host.innerHTML = "";

  let items = DATA.kpis.slice();
  if (q) items = items.filter(k => k.text.toLowerCase().includes(q) || groupTitle(k.groupId).toLowerCase().includes(q));
  items.sort((a,b)=>a.groupId.localeCompare(b.groupId));

  for (const k of items) {
    const div = document.createElement("div");
    div.className = "item kind-kpi";
    div.setAttribute("data-key", `kpi:${k.id}`);
    div.onclick = () => select("kpi", k.id, {autoTab:"kpis"});
    div.innerHTML = `
      <div class="row" style="justify-content: space-between;">
        <div class="t">${esc(k.text)}</div>
        <div class="row"><span class="chip group mono">${k.groupId}</span></div>
      </div>
      <div class="m">${esc(groupTitle(k.groupId))}</div>
    `;
    host.appendChild(div);
  }
}

function renderKpiDetail(id) {
  const host = byId("kpiDetailBody");
  const k = DATA.kpis.find(x=>x.id===id);
  if (!k) return;

  const gId = k.groupId;
  const inits = findInitiativesForGroup(gId).map(i => ({id: i.id, label: (i.season? i.season+": " : "") + i.text}));
  const sys = findSystemsForGroup(gId).map(s => ({id: s.id, label: s.text}));

  host.innerHTML = `
    <h1>${esc(k.text)}</h1>
    <p><span class="chip group mono">${gId}</span> ${esc(groupTitle(gId))}</p>
    <div class="section"><div class="st">Systems that influence this</div>${linkPills(sys, "jumpSys", "system")}</div>
    <div class="section"><div class="st">Initiatives driving it</div>${linkPills(inits, "jumpInit", "initiative")}</div>
    <div class="section">
      <div class="st">Quick actions</div>
      <div class="row">
        <button class="btn primary" onclick="pinToWorkbench('KPIs','kpi','${id}')">Pin</button>
        <button class="btn" onclick="select('challengeGroup','${gId}',{autoTab:'challenges'})">Back to challenge</button>
      </div>
    </div>
  `;
}

function exportJSON() {
  const blob = new Blob([JSON.stringify(DATA, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "mikron_navigator_data.json";
  a.click();
  URL.revokeObjectURL(a.href);
}

function pinToWorkbench(colName, type, id) {
  let label = "";
  if (type==="challengeGroup") label = groupTitle(id);
  else if (type==="subChallenge") label = (DATA.subChallenges.find(x=>x.id===id)?.text || id);
  else if (type==="initiative") {
    const it = DATA.initiatives.find(x=>x.id===id);
    label = (it?.season? it.season+": " : "") + (it?.text || id);
  } else if (type==="system") label = (DATA.systems.find(x=>x.id===id)?.text || id);
  else if (type==="kpi") label = (DATA.kpis.find(x=>x.id===id)?.text || id);

  const card = {type, id, label};
  if (!state.workbench[colName]) state.workbench[colName]=[];
  const exists = state.workbench[colName].some(x=>x.type===type && x.id===id);
  if (!exists) state.workbench[colName].push(card);
  renderWorkbench();
}

function moveCard(col, idx, dir) {
  const arr = state.workbench[col];
  const j = idx + dir;
  if (j<0 || j>=arr.length) return;
  const tmp = arr[idx]; arr[idx]=arr[j]; arr[j]=tmp;
  renderWorkbench();
}
function removeCard(col, idx) {
  state.workbench[col].splice(idx,1);
  renderWorkbench();
}

function renderWorkbench() {
  const host = byId("kanban");
  const cols = ["Challenges","Initiatives","Systems","KPIs"];
  host.innerHTML = "";

  for (const c of cols) {
    const div = document.createElement("div");
    div.className = "col";
    div.innerHTML = `<h3>${c}</h3>`;
    const cards = state.workbench[c] || [];

    for (let i=0;i<cards.length;i++) {
      const card = cards[i];
      const el = document.createElement("div");
      const kind = (card.type==="initiative") ? "initiative" : (card.type==="system") ? "system" : (card.type==="kpi") ? "kpi" : "challenge";
      el.className = "card kind-" + kind;
      el.draggable = true;
      el.ondragstart = (ev)=>{ ev.dataTransfer.setData("text/plain", JSON.stringify({col:c, idx:i})); };

      el.innerHTML = `
        <div class="t">${esc(card.label)}</div>
        <div class="m mono">${card.type}:${card.id}</div>
        <div class="actions">
          <button class="btn small primary" onclick="select('${card.type}','${card.id}',{autoTab: inferTab('${card.type}')} )">Open</button>
          <button class="btn small" onclick="moveCard('${c}',${i},-1)">↑</button>
          <button class="btn small" onclick="moveCard('${c}',${i},1)">↓</button>
          <button class="btn small" onclick="removeCard('${c}',${i})">Remove</button>
        </div>
      `;
      div.appendChild(el);
    }

    div.ondragover = (ev)=>{ ev.preventDefault(); };
    div.ondrop = (ev)=>{
      ev.preventDefault();
      try {
        const src = JSON.parse(ev.dataTransfer.getData("text/plain"));
        const card = state.workbench[src.col][src.idx];
        state.workbench[src.col].splice(src.idx,1);
        state.workbench[c].push(card);
        renderWorkbench();
      } catch(e) {}
    };

    host.appendChild(div);
  }
}

function saveWorkbench() {
  localStorage.setItem("mikronNavigatorWorkbench", JSON.stringify(state.workbench));
  alert("Workbench saved in this browser.");
}
function loadWorkbench() {
  const raw = localStorage.getItem("mikronNavigatorWorkbench");
  if (!raw) return alert("No saved workbench found.");
  try { state.workbench = JSON.parse(raw); renderWorkbench(); } catch(e) { alert("Could not load saved state."); }
}
function clearWorkbench() {
  state.workbench = {Challenges:[],Initiatives:[],Systems:[],KPIs:[]};
  renderWorkbench();
}

function initFromHash() {
  const h = (location.hash || "").replace(/^#/, "");
  if (!h) return;
  const parts = h.split("/");
  const tab = parts[0];
  if (TABS.some(t=>t.id===tab)) setTab(tab);
  if (parts[1]) {
    const [type, id] = parts[1].split(":");
    if (type && id) select(type, id, {autoTab: inferTab(type)});
  }
}

function wireSearch() {
  byId("searchChallenges").addEventListener("input", renderChallengeTree);
  byId("searchInitiatives").addEventListener("input", renderInitiativeList);
  byId("searchSystems").addEventListener("input", renderSystemList);
  byId("searchKpis").addEventListener("input", renderKpiList);
}

function bootstrap() {
  renderTabs();
  wireSearch();
  renderChallengeTree();
  renderInitiativeList();
  renderSystemList();
  renderKpiList();

  renderWorkbench();
  initFromHash();
  if (!state.selected) select("challengeGroup", DATA.challengeGroups[0].id, {autoTab:"challenges"});
}

bootstrap();
</script>
</body>
</html>
